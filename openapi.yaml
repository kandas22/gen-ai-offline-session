openapi: 3.0.3
info:
  title: GAF Search Automation & E2E Testing API
  description: |
    Flask API for Google Search Automation with BDD Testing and Playwright E2E Testing support.
    
    **Features:**
    - üîç SerpAPI-based Google search (no reCAPTCHA)
    - ‚ö° Synchronous and asynchronous search endpoints
    - üß™ BDD test generation and execution
    - üé≠ Playwright browser automation for E2E tests
    - üîß Auto-fix for failed tests
    - üíæ Database persistence for test executions
    - üìä Test execution history and reporting
    
    **Base URL:** `http://localhost:5001`
    
    **Getting Started:**
    1. Use `/api/search` for Google searches
    2. Use `/api/bdd/generate-and-execute` for E2E tests
    3. Use `/api/bdd/playwright/results/{task_id}` to get test results
    4. Use `/api/bdd/executions` to view execution history
  version: 2.0.0
  contact:
    name: API Support

servers:
  - url: http://localhost:5001
    description: Local development server
  - url: http://0.0.0.0:5001
    description: Network accessible server

tags:
  - name: Health
    description: Health check endpoints
  - name: Search
    description: Google search operations
  - name: BDD
    description: BDD test generation and execution
  - name: Playwright
    description: Playwright browser automation and E2E testing
  - name: Database
    description: Database query endpoints for test execution history

paths:
  /:
    get:
      tags:
        - Health
      summary: Health check
      description: Check if the API is running and healthy
      operationId: healthCheck
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  service:
                    type: string
                    example: GAF Search Automation API
                  version:
                    type: string
                    example: 1.0.0

  /api/docs:
    get:
      tags:
        - Health
      summary: API Documentation UI
      description: Interactive API documentation using Swagger UI
      operationId: apiDocs
      responses:
        '200':
          description: HTML page with Swagger UI
          content:
            text/html:
              schema:
                type: string

  /swagger:
    get:
      tags:
        - Health
      summary: Swagger UI (alias)
      description: Alternative endpoint for Swagger UI
      operationId: swagger
      responses:
        '200':
          description: HTML page with Swagger UI
          content:
            text/html:
              schema:
                type: string

  /openapi.yaml:
    get:
      tags:
        - Health
      summary: OpenAPI Specification
      description: Get the OpenAPI specification in YAML format
      operationId: openApiSpec
      responses:
        '200':
          description: OpenAPI YAML specification
          content:
            text/yaml:
              schema:
                type: string

  /api/search/sync:
    post:
      tags:
        - Search
      summary: Synchronous Google search
      description: Perform a Google search and wait for results (uses SerpAPI)
      operationId: searchSync
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                query:
                  type: string
                  description: Search query (defaults to "rain news today" if not provided)
                  example: rain news today
      responses:
        '200':
          description: Search completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/SearchResult'
        '500':
          description: Search failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/search:
    post:
      tags:
        - Search
      summary: Asynchronous Google search
      description: Start a Google search in the background and return a task ID
      operationId: searchAsync
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                query:
                  type: string
                  description: Search query (defaults to "rain news today" if not provided)
                  example: weather forecast
      responses:
        '202':
          description: Search task created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  task_id:
                    type: string
                    example: abc123def456
                  message:
                    type: string
                    example: Search started
        '500':
          description: Failed to start search
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/search/status/{task_id}:
    get:
      tags:
        - Search
      summary: Get search task status
      description: Check the status of an asynchronous search task
      operationId: getSearchStatus
      parameters:
        - name: task_id
          in: path
          required: true
          description: Task ID returned from async search
          schema:
            type: string
            example: abc123def456
      responses:
        '200':
          description: Task status retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  task_id:
                    type: string
                    example: abc123def456
                  status:
                    type: string
                    enum: [pending, running, completed, failed]
                    example: completed
                  created_at:
                    type: string
                    format: date-time
                  updated_at:
                    type: string
                    format: date-time
        '404':
          description: Task not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/search/results/{task_id}:
    get:
      tags:
        - Search
      summary: Get search task results
      description: Retrieve the results of an asynchronous search task
      operationId: getSearchResults
      parameters:
        - name: task_id
          in: path
          required: true
          description: Task ID returned from async search
          schema:
            type: string
            example: abc123def456
      responses:
        '200':
          description: Task results retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  task_id:
                    type: string
                  status:
                    type: string
                  result:
                    $ref: '#/components/schemas/SearchResult'
                  error:
                    type: string
                    nullable: true
        '404':
          description: Task not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/bdd/generate:
    post:
      tags:
        - BDD
      summary: Generate BDD test
      description: Generate a BDD test from natural language specification
      operationId: generateBDD
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - specification
              properties:
                specification:
                  type: string
                  description: Natural language test specification
                  example: Given I am on Google, When I search for rain news today, Then I should see news results
      responses:
        '200':
          description: BDD test generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      test_id:
                        type: string
                      feature_file:
                        type: string
                      content:
                        type: string
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/bdd/execute:
    post:
      tags:
        - BDD
      summary: Execute BDD test
      description: Execute a generated BDD test
      operationId: executeBDD
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - test_id
              properties:
                test_id:
                  type: string
                  description: Test ID from generation
                  example: test_abc123
                feature_file:
                  type: string
                  description: Optional path to feature file
                  example: /path/to/test.feature
      responses:
        '202':
          description: BDD test execution started
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  task_id:
                    type: string
                  message:
                    type: string
                    example: BDD test execution started
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/bdd/results/{test_id}:
    get:
      tags:
        - BDD
      summary: Get BDD test results
      description: Retrieve the results of a BDD test execution
      operationId: getBDDResults
      parameters:
        - name: test_id
          in: path
          required: true
          description: Test ID
          schema:
            type: string
            example: test_abc123
      responses:
        '200':
          description: Test results retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
        '404':
          description: Results not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/bdd/auto-fix:
    post:
      tags:
        - BDD
      summary: Auto-fix failed BDD test
      description: Automatically fix a failed BDD test
      operationId: autoFixBDD
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - test_id
              properties:
                test_id:
                  type: string
                  description: Test ID to fix
                  example: test_abc123
      responses:
        '200':
          description: Auto-fix applied
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
        '404':
          description: Test results not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/bdd/generate-and-execute:
    post:
      tags:
        - BDD
        - Playwright
      summary: Generate and execute Playwright test
      description: Generate BDD test and execute with Playwright in one step
      operationId: generateAndExecutePlaywright
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - specification
              properties:
                specification:
                  type: object
                  properties:
                    feature:
                      type: object
                      properties:
                        name:
                          type: string
                          example: Login Test
                        description:
                          type: string
                          example: Test user login functionality
                        tags:
                          type: array
                          items:
                            type: string
                          example: ["@login", "@smoke"]
                    scenarios:
                      type: array
                      items:
                        $ref: '#/components/schemas/PlaywrightScenario'
                    configuration:
                      $ref: '#/components/schemas/PlaywrightConfiguration'
                async:
                  type: boolean
                  description: Execute asynchronously (returns task_id)
                  default: false
      responses:
        '200':
          description: Test executed successfully (sync)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/PlaywrightResult'
        '202':
          description: Test execution started (async)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  task_id:
                    type: string
                  message:
                    type: string
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/bdd/execute-playwright:
    post:
      tags:
        - Playwright
      summary: Execute Playwright test
      description: Execute a Playwright test from specification
      operationId: executePlaywright
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - specification
              properties:
                specification:
                  type: object
                  properties:
                    feature:
                      type: object
                    scenarios:
                      type: array
                      items:
                        $ref: '#/components/schemas/PlaywrightScenario'
                    configuration:
                      $ref: '#/components/schemas/PlaywrightConfiguration'
      responses:
        '200':
          description: Test executed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/PlaywrightResult'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/bdd/playwright/results/{task_id}:
    get:
      tags:
        - Playwright
      summary: Get Playwright test results
      description: Retrieve Playwright test results by task ID
      operationId: getPlaywrightResults
      parameters:
        - name: task_id
          in: path
          required: true
          description: Task ID returned from test execution
          schema:
            type: string
            example: abc123def456
      responses:
        '200':
          description: Test results retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  task_id:
                    type: string
                  status:
                    type: string
                    enum: [pending, running, completed, failed]
                  result:
                    $ref: '#/components/schemas/PlaywrightResult'
                  error:
                    type: string
                    nullable: true
                  created_at:
                    type: string
                    format: date-time
                  updated_at:
                    type: string
                    format: date-time
        '404':
          description: Task not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/bdd/executions:
    get:
      tags:
        - Database
      summary: Get all test executions
      description: Retrieve all test executions from database
      operationId: getAllExecutions
      parameters:
        - name: limit
          in: query
          description: Maximum number of executions to return
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 200
      responses:
        '200':
          description: List of test executions
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  count:
                    type: integer
                  executions:
                    type: array
                    items:
                      $ref: '#/components/schemas/TestExecution'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/bdd/executions/{task_id}:
    get:
      tags:
        - Database
      summary: Get test execution by ID
      description: Retrieve specific test execution from database
      operationId: getExecutionById
      parameters:
        - name: task_id
          in: path
          required: true
          description: Task ID of the test execution
          schema:
            type: string
            example: abc123def456
      responses:
        '200':
          description: Test execution details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  execution:
                    $ref: '#/components/schemas/TestExecution'
        '404':
          description: Execution not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    SearchResult:
      type: object
      properties:
        query:
          type: string
          example: rain news today
        timestamp:
          type: string
          format: date-time
        success:
          type: boolean
          example: true
        results:
          type: array
          items:
            $ref: '#/components/schemas/SearchItem'
        total_results:
          type: integer
          example: 10
        screenshots:
          type: array
          items:
            type: string
          description: Array of screenshot file paths (empty for SerpAPI)
        error:
          type: string
          nullable: true

    SearchItem:
      type: object
      properties:
        title:
          type: string
          example: Little Rock Weather News
        url:
          type: string
          format: uri
          example: https://katv.com/weather
        snippet:
          type: string
          example: Widespread rain arrives on Saturday...
        type:
          type: string
          enum: [search, news]
          example: search
        position:
          type: integer
          example: 1
        source:
          type: string
          description: News source (for news results)
        date:
          type: string
          description: Publication date (for news results)

    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: An error occurred

    PlaywrightConfiguration:
      type: object
      properties:
        browser:
          type: string
          enum: [chromium, firefox, webkit]
          default: chromium
          example: chromium
        headless:
          type: boolean
          default: true
          example: true
        timeout:
          type: integer
          description: Default timeout in milliseconds
          default: 30000
          example: 30000

    PlaywrightScenario:
      type: object
      properties:
        scenario_id:
          type: string
          example: scenario_001
        scenario_name:
          type: string
          example: User login
        tags:
          type: array
          items:
            type: string
          example: ["@smoke", "@login"]
        given:
          type: array
          items:
            type: object
            properties:
              step:
                type: string
              url:
                type: string
              wait_until:
                type: string
                enum: [load, domcontentloaded, networkidle]
              timeout:
                type: integer
              retries:
                type: integer
        when:
          type: array
          items:
            type: object
            properties:
              step:
                type: string
              action:
                type: string
                enum: [click, search, navigate, fill]
              element:
                type: object
              search_term:
                type: string
        then:
          type: array
          items:
            type: object
            properties:
              step:
                type: string
              validation_type:
                type: string
                enum: [element_visible, element_exists, text_content, url_contains, cart_items_count]
              element:
                type: object
              expected_text:
                type: string
              expected_result:
                type: string

    PlaywrightResult:
      type: object
      properties:
        feature:
          type: object
          properties:
            name:
              type: string
            description:
              type: string
        configuration:
          $ref: '#/components/schemas/PlaywrightConfiguration'
        scenarios:
          type: array
          items:
            type: object
            properties:
              scenario_id:
                type: string
              scenario_name:
                type: string
              tags:
                type: array
                items:
                  type: string
              status:
                type: string
                enum: [passed, failed, partial, pending]
              steps:
                type: array
                items:
                  type: object
                  properties:
                    step:
                      type: string
                    type:
                      type: string
                      enum: [given, when, then]
                    status:
                      type: string
                      enum: [passed, failed, pending]
                    message:
                      type: string
                    error:
                      type: string
              start_time:
                type: string
                format: date-time
              end_time:
                type: string
                format: date-time
        summary:
          type: object
          properties:
            total:
              type: integer
            passed:
              type: integer
            failed:
              type: integer
            pass_rate:
              type: string
        status:
          type: string
          enum: [passed, failed, partial]
        start_time:
          type: string
          format: date-time
        end_time:
          type: string
          format: date-time

    TestExecution:
      type: object
      properties:
        task_id:
          type: string
          example: abc123def456
        test_id:
          type: string
          example: test_abc123
        feature_name:
          type: string
          example: Login Test
        status:
          type: string
          enum: [pending, running, completed, failed]
          example: completed
        result:
          type: object
          nullable: true
        error:
          type: string
          nullable: true
        response_code:
          type: integer
          nullable: true
          example: 200
        response_status:
          type: string
          nullable: true
          example: OK
        total_scenarios:
          type: integer
          nullable: true
          example: 5
        passed_scenarios:
          type: integer
          nullable: true
          example: 4
        failed_scenarios:
          type: integer
          nullable: true
          example: 1
        pass_rate:
          type: string
          nullable: true
          example: "80.00%"
        start_time:
          type: string
          format: date-time
          nullable: true
        end_time:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
